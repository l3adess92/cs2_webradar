name: ðŸš€ BUILD CS2 RADAR

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    # Ã‰TAPE 1: TÃ©lÃ©charger
    - uses: actions/checkout@v4
    
    # Ã‰TAPE 2: Explorer
    - name: ðŸ” EXPLORE STRUCTURE
      shell: cmd
      run: |
        echo === STRUCTURE COMPLÃˆTE ===
        dir /s
        
        echo === TROUVER .SLN ===
        dir *.sln /s
        
        echo === TROUVER .EXE ===  
        dir *.exe /s
        
    # Ã‰TAPE 3: Compiler SIMPLEMENT
    - name: ðŸ”¨ COMPILER
      shell: cmd
      run: |
        # Aller dans le bon dossier
        if exist "cs2_webradar\cs2_webradar.sln" (
            cd cs2_webradar
            echo Compiling from main folder...
        )
        
        # Compiler
        if exist "usermode\cs2_webradar.sln" (
            cd usermode
            echo Compiling usermode...
            msbuild cs2_webradar.sln /p:Configuration=Release
        )
        
    # Ã‰TAPE 4: CHERCHER L'EXE PARTOUT
    - name: ðŸ”Ž FIND EXECUTABLE
      shell: cmd
      run: |
        echo === RECHERCHE .EXE ===
        
        :: Chercher dans tous les dossiers
        for /r %%i in (*.exe) do (
            echo FOUND: %%i
            copy "%%i" "radar_app.exe"
            goto :found
        )
        
        :: Si pas trouvÃ©, essayer chemins connus
        if exist "cs2_webradar\usermode\x64\Release\cs2_webradar.exe" (
            copy "cs2_webradar\usermode\x64\Release\cs2_webradar.exe" "radar_app.exe"
        ) else if exist "usermode\x64\Release\cs2_webradar.exe" (
            copy "usermode\x64\Release\cs2_webradar.exe" "radar_app.exe"
        ) else if exist "cs2_webradar\cs2_webradar\usermode\x64\Release\cs2_webradar.exe" (
            copy "cs2_webradar\cs2_webradar\usermode\x64\Release\cs2_webradar.exe" "radar_app.exe"
        ) else (
            echo âŒ AUCUN .EXE TROUVE
            exit 1
        )
        
        :found
        echo âœ… EXE COPIE: radar_app.exe
        
    # Ã‰TAPE 5: PRÃ‰PARER WEBAPP
    - name: ðŸŒ PREPARE WEB
      shell: cmd
      run: |
        if exist "cs2_webradar\webapp" (
            xcopy "cs2_webradar\webapp" "webapp" /E /I
        ) else if exist "webapp" (
            echo Webapp deja present
        )
        
        if exist "webapp" (
            cd webapp
            call npm install --silent
        )
        
    # Ã‰TAPE 6: CRÃ‰ER PACKAGE
    - name: ðŸ“¦ CREATE PACKAGE
      shell: cmd
      run: |
        echo === CRÃ‰ATION PACKAGE ===
        
        mkdir CS2_RADAR_FINAL
        
        :: Copier exe
        if exist "radar_app.exe" (
            copy "radar_app.exe" "CS2_RADAR_FINAL\usermode.exe"
            echo âœ… usermode.exe
        )
        
        :: Copier webapp
        if exist "webapp" (
            xcopy "webapp" "CS2_RADAR_FINAL\webapp" /E /I
            echo âœ… webapp
        )
        
        :: CrÃ©er START.bat
        echo @echo off > "CS2_RADAR_FINAL\START.bat"
        echo echo Launching CS2 Radar... >> "CS2_RADAR_FINAL\START.bat"
        echo cd /d "%%~dp0webapp" >> "CS2_RADAR_FINAL\START.bat"
        echo start "Web" npm start >> "CS2_RADAR_FINAL\START.bat"
        echo timeout /t 3 >> "CS2_RADAR_FINAL\START.bat"
        echo cd .. >> "CS2_RADAR_FINAL\START.bat"
        echo start "Radar" usermode.exe >> "CS2_RADAR_FINAL\START.bat"
        echo start http://localhost:5173 >> "CS2_RADAR_FINAL\START.bat"
        echo echo âœ… Ready! Launch CS2 with -insecure >> "CS2_RADAR_FINAL\START.bat"
        echo pause >> "CS2_RADAR_FINAL\START.bat"
        echo âœ… START.bat
        
        :: ZIP
        "C:\Program Files\7-Zip\7z.exe" a -tzip CS2_RADAR.zip CS2_RADAR_FINAL\*
        
        echo.
        echo âœ… PACKAGE CREATED: CS2_RADAR.zip
        
    # Ã‰TAPE 7: UPLOAD
    - uses: actions/upload-artifact@v4
      with:
        name: CS2-RADAR-PACKAGE
        path: CS2_RADAR.zip
