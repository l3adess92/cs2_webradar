name: üöÄ Build CS2 Radar

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: üì• Download
      uses: actions/checkout@v4
      
    - name: üîç DEBUG - Show Actual Structure
      shell: cmd
      run: |
        echo ACTUAL PATH: %CD%
        echo.
        echo ALL FILES:
        dir
        echo.
        echo SUBFOLDERS:
        if exist cs2_webradar (
          cd cs2_webradar
          dir
          cd ..
        )
      
    - name: üî® Compile from CORRECT PATH
      shell: cmd
      run: |
        # LE CHEMIN EST: cs2_webradar\cs2_webradar\
        if exist "cs2_webradar\cs2_webradar.sln" (
          echo "Compiling from cs2_webradar\"
          cd cs2_webradar
        )
        
        msbuild usermode\cs2_webradar.sln /p:Configuration=Release /p:Platform=x64
        
    - name: üìÑ Copy EXE from CORRECT LOCATION
      shell: cmd
      run: |
        # LE .exe EST ICI: cs2_webradar\cs2_webradar\usermode\x64\Release\
        if exist "cs2_webradar\usermode\x64\Release\cs2_webradar.exe" (
          echo "Copying from cs2_webradar\usermode\..."
          copy "cs2_webradar\usermode\x64\Release\cs2_webradar.exe" "windows_app.exe"
        ) else if exist "usermode\x64\Release\cs2_webradar.exe" (
          echo "Copying from usermode\..."
          copy "usermode\x64\Release\cs2_webradar.exe" "windows_app.exe"
        ) else (
          echo "ERROR: .exe not found! Searching..."
          dir *.exe /s /b
          exit 1
        )
        
        echo "‚úÖ windows_app.exe created"
      
    - name: üì¶ Create ZIP
      shell: cmd
      run: |
        # Copier webapp depuis le BON chemin
        if exist "cs2_webradar\webapp" (
          xcopy "cs2_webradar\webapp" "webapp" /E /I
        )
        
        "C:\Program Files\7-Zip\7z.exe" a final.zip windows_app.exe webapp
        
    - uses: actions/upload-artifact@v4
      with:
        name: cs2-radar
        path: final.zip
